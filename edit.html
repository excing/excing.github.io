<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>编辑-excQ's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="iA Writer Pro 1.5.2 (6015)">
    <meta name="theme-color" content="#005baa" />
    <style type="text/css">
    .sbibod {
    background-color: #fff;
    vertical-align: top;
    border-radius: 2px;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.16), 0 0 0 1px rgba(0,0,0,0.08);
    transition: box-shadow 200ms cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    </style>
</head>
<body>
<div style="position: absolute; top: 0.3em; left: 0.3em; right: 1em; bottom: 0em;height: 44px;">
<input type="text" id="blog_title" class="sbibod" style="margin: 0px;padding: 5px;font: 16px arial,sans-serif;width: 100%; height: 44px;border: none;"></input>
</div>
<div style="font-size: 13px; width: 300px; height: 30px;">Key buffer: <span id="command-display"></span></div>
<div style="position: absolute; top: 60px; left: 0.3em; right: 1em; bottom: 1em;">
<textarea id="blog_content" class="sbibod" name="blog_content" style="width: 100%; height: 100%;padding: 5px;border: none; font-size: 150%"></textarea>
</div>
<script src="./http4js.js"></script>
<script src="./urls.js"></script>
<script src="./config.js"></script>
<script>
    var id = getQueryVariable("id");
    var lastTitle = "";
    var lastContent = "";

    function call(data) {
        // alert("请求成功 " + data.length);
        var result = JSON.parse(data);

        document.title = result.title + "-ExcQ's BOLG"; 

        var titleH1 = document.getElementById('blog_title');
        titleH1.value = result.title;

        var contentTextare = document.getElementById('blog_content');
        contentTextare.value = result.content;
    }

    if (id != "") {
        get(api_domain + '/view/' + id, call);
    }

    function saveBlogCallback(data) {
        id = data;
    }

    function saveBlog() {
        var title = document.getElementById("blog_title").value;
        var content = document.getElementById("blog_content").value;

        if (lastTitle != title || lastContent != content) {
            lastTitle = title;
            lastContent = content;

            var channel = "webpc";
            var contentType = "md";
            var updateTime = new Date().getTime();

            if (id != "") {
                postJson(api_domain + '/edit', {id: id, title: title, content: content, contentType: contentType, channel: channel, editTime: updateTime}); 
            } else {
                postJson(api_domain + '/edit', {title: title, content: content, contentType: contentType, channel: channel, editTime: updateTime}, saveBlogCallback); 
            }
        }

        setTimeout(saveBlog, 1000);
    }

    setTimeout(saveBlog, 1000);
</script>
</body>
</html>